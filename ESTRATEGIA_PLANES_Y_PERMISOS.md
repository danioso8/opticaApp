# Estrategia de Planes y Permisos - OptikaApp

## üéØ Objetivo
Dise√±ar una estructura de planes que:
1. **Plan Free (30 d√≠as)**: Permita probar funcionalidad b√°sica pero genere necesidad de upgrade
2. **Plan B√°sico**: Para √≥pticas peque√±as independientes (1-2 empleados)
3. **Plan Profesional**: Para √≥pticas medianas en crecimiento (3-10 empleados)
4. **Plan Premium**: Para cadenas o √≥pticas grandes (10+ empleados)

---

## üìã M√ìDULOS DEL SISTEMA (23 Total)

### M√≥dulos Esenciales (Core) - Deben estar en todos los planes
- ‚úÖ Dashboard / Inicio
- ‚úÖ Citas / Agendamiento
- ‚úÖ Pacientes
- ‚úÖ Historia Cl√≠nica B√°sica
- ‚úÖ Doctores/Personal
- ‚úÖ Configuraci√≥n B√°sica

### M√≥dulos de Ventas e Inventario
- üí∞ Ventas / POS
- üè∑Ô∏è Promociones
- üì¶ Inventario/Stock
- üëì Productos/Cat√°logo
- üíä F√≥rmulas Oft√°lmicas
- üíµ Caja/Registro

### M√≥dulos Administrativos
- üìä Reportes B√°sicos
- üìà An√°lisis Avanzado
- üìù Documentos
- üîç Auditor√≠a
- ‚öôÔ∏è Configuraci√≥n Avanzada

### M√≥dulos de RRHH
- üë• Gesti√≥n de Equipos
- üíº N√≥mina Electr√≥nica DIAN
- üîê Permisos y Roles Avanzados

### M√≥dulos de Automatizaci√≥n
- üîÑ Workflows
- ‚úÖ Tareas Autom√°ticas
- üîî Notificaciones Push
- üì± Integraci√≥n WhatsApp

### M√≥dulos de Integraciones
- üåê API REST
- üè¢ Multi-sede
- üé® Landing Page Personalizable
- üí≥ Facturaci√≥n Electr√≥nica DIAN

---

## üéÅ PLAN FREE (30 D√çAS DE PRUEBA)

### Estrategia
- Permitir **suficiente funcionalidad** para enamorarse del sistema
- **Limitar** caracter√≠sticas avanzadas y automatizaci√≥n
- Crear **dolor** cuando lleguen a los l√≠mites

### M√≥dulos Incluidos (10/23)
‚úÖ **Gesti√≥n Cl√≠nica B√°sica**
- Dashboard/Inicio
- Citas (l√≠mite: 50/mes)
- Pacientes (l√≠mite: 100 total)
- Historia Cl√≠nica B√°sica (sin campos avanzados)
- Doctores (l√≠mite: 2)

‚úÖ **Ventas B√°sicas**
- Ventas/POS (sin promociones autom√°ticas)
- Productos (l√≠mite: 50 SKU)
- Caja (registro simple)

‚úÖ **Landing Page**
- Landing page b√°sica (plantilla predeterminada, sin personalizaci√≥n avanzada)

üö´ **Sin acceso a:**
- Promociones
- Reportes avanzados
- N√≥mina
- WhatsApp
- Workflows/Automatizaci√≥n
- Facturaci√≥n Electr√≥nica DIAN
- Multi-sede
- API
- Auditor√≠a
- Inventario avanzado
- An√°lisis predictivo

### L√≠mites del Plan Free
```
- Usuarios: 1
- Organizaciones: 1
- Pacientes: 100
- Citas/mes: 50
- Productos: 50 SKU
- Doctores: 2
- Almacenamiento: 100 MB
- Duraci√≥n: 30 d√≠as
- Landing Page: Plantilla b√°sica (sin personalizaci√≥n de colores/logo)
- Soporte: Email (48-72 hrs respuesta)
- Mensajes WhatsApp: 0 (Feature bloqueado)
- Facturas DIAN/mes: 0 (Feature bloqueado)
```

---

## üíº PLAN B√ÅSICO ($49.900/mes - $499.000/a√±o)

### Target
√ìpticas peque√±as independientes con 1-3 empleados

### M√≥dulos Incluidos (16/23)
‚úÖ Todo lo del Plan Free +
- Inventario/Stock completo
- F√≥rmulas Oft√°lmicas
- Reportes B√°sicos
- Configuraci√≥n Avanzada
- Documentos
- Permisos y Roles B√°sicos

### L√≠mites
```
- Usuarios: 3
- Organizaciones: 1
- Pacientes: Ilimitados
- Citas/mes: Ilimitadas
- Productos: Ilimitados
- Doctores: 5
- Almacenamiento: 5 GB
- Landing Page: Personalizable (colores, logo, textos)
- Soporte: Email + Chat (24 hrs respuesta)
- Mensajes WhatsApp: 500/mes incluidos ($50 COP c/u adicional)
- Facturas DIAN/mes: 0 (add-on disponible: +$29.900/mes)
- Multi-sede: No
- API: No
```

---

## üöÄ PLAN PROFESIONAL ($99.900/mes - $999.000/a√±o) ‚≠ê M√ÅS POPULAR

### Target
√ìpticas medianas en crecimiento con 3-10 empleados

### M√≥dulos Incluidos (21/23)
‚úÖ Todo lo del Plan B√°sico +
- Promociones autom√°ticas
- An√°lisis Avanzado
- Auditor√≠a
- Gesti√≥n de Equipos
- N√≥mina Electr√≥nica DIAN (add-on)
- Workflows b√°sicos
- Tareas Autom√°ticas
- Notificaciones Push
- WhatsApp Business Integration

### L√≠mites
```
- Usuarios: 10
- Organizaciones: 1
- Pacientes: Ilimitados
- Citas/mes: Ilimitadas
- Productos: Ilimitados
- Doctores: Ilimitados
- Almacenamiento: 50 GB
- Landing Page: Totalmente personalizable + SEO
- Soporte: Email + Chat + WhatsApp (8 hrs respuesta)
- Mensajes WhatsApp: 2.000/mes incluidos ($40 COP c/u adicional)
- Facturas DIAN/mes: 500 ($20 COP c/u adicional)
- Multi-sede: Hasta 3 sedes
- API: Acceso b√°sico (1.000 requests/mes)
```

---

## üíé PLAN PREMIUM ($199.900/mes - $1.999.000/a√±o)

### Target
Cadenas de √≥pticas o √≥pticas grandes con 10+ empleados

### M√≥dulos Incluidos (23/23 - TODOS)
‚úÖ Acceso completo a todos los m√≥dulos
- Todo lo del Plan Profesional +
- API REST completa
- Multi-sede ilimitado
- Workflows avanzados
- Integraci√≥n completa con sistemas externos
- An√°lisis predictivo con IA
- Soporte prioritario

### L√≠mites
```
- Usuarios: Ilimitados
- Organizaciones: Ilimitadas
- Pacientes: Ilimitados
- Citas/mes: Ilimitadas
- Productos: Ilimitados
- Doctores: Ilimitados
- Almacenamiento: Ilimitado
- Landing Page: Personalizable + M√∫ltiples p√°ginas + Blog
- Soporte: 24/7 Email + Chat + WhatsApp + Tel√©fono (2 hrs respuesta)
- Mensajes WhatsApp: 10.000/mes incluidos ($30 COP c/u adicional)
- Facturas DIAN/mes: Ilimitadas
- Multi-sede: Ilimitadas
- API: Acceso completo (ilimitado)
- Implementaci√≥n personalizada: Incluida
- Capacitaci√≥n: 4 horas incluidas/mes
```

---

## üîí SISTEMA DE PERMISOS POR M√ìDULO

### C√≥digos de Features (PlanFeature)

```python
CORE_FEATURES = [
    'dashboard',              # Dashboard principal
    'appointments',           # Gesti√≥n de citas
    'patients',              # Gesti√≥n de pacientes
    'clinical_history_basic', # Historia cl√≠nica b√°sica
    'doctors',               # Gesti√≥n de doctores
    'configuration_basic',   # Configuraci√≥n b√°sica
]

SALES_FEATURES = [
    'sales_pos',             # Punto de venta
    'promotions',            # Sistema de promociones
    'inventory',             # Control de inventario
    'products',              # Cat√°logo de productos
    'formulas',              # F√≥rmulas oft√°lmicas
    'cash_register',         # Registro de caja
]

ADMIN_FEATURES = [
    'reports_basic',         # Reportes b√°sicos
    'analytics_advanced',    # An√°lisis avanzado
    'documents',             # Gesti√≥n de documentos
    'audit',                 # Auditor√≠a del sistema
    'configuration_advanced', # Configuraci√≥n avanzada
]

HR_FEATURES = [
    'teams',                 # Gesti√≥n de equipos
    'payroll_dian',          # N√≥mina electr√≥nica DIAN
    'permissions_advanced',  # Permisos y roles avanzados
]

AUTOMATION_FEATURES = [
    'workflows',             # Automatizaci√≥n de workflows
    'tasks',                 # Tareas autom√°ticas
    'notifications_push',    # Notificaciones push
    'whatsapp_integration',  # Integraci√≥n WhatsApp
]

INTEGRATION_FEATURES = [
    'api_rest',              # API REST
    'multi_location',        # Multi-sede
    'landing_page',          # Landing page personalizable
    'electronic_invoicing',  # Facturaci√≥n electr√≥nica DIAN
]
```

### Asignaci√≥n de Features por Plan

```python
# Plan Free (30 d√≠as)
FREE_FEATURES = [
    'dashboard',
    'appointments',
    'patients',
    'clinical_history_basic',
    'doctors',
    'configuration_basic',
    'sales_pos',
    'products',
    'cash_register',
    'landing_page',  # Versi√≥n b√°sica
]

# Plan B√°sico
BASIC_FEATURES = FREE_FEATURES + [
    'inventory',
    'formulas',
    'reports_basic',
    'documents',
    'configuration_advanced',
    'permissions_advanced',  # Versi√≥n b√°sica
]

# Plan Profesional
PROFESSIONAL_FEATURES = BASIC_FEATURES + [
    'promotions',
    'analytics_advanced',
    'audit',
    'teams',
    'workflows',  # Versi√≥n b√°sica
    'tasks',
    'notifications_push',
    'whatsapp_integration',
    'electronic_invoicing',
    'multi_location',  # Hasta 3 sedes
    'api_rest',  # Acceso b√°sico
]

# Plan Premium (TODOS)
PREMIUM_FEATURES = PROFESSIONAL_FEATURES + [
    'payroll_dian',
    # Todos los features en versi√≥n completa/ilimitada
]
```

---

## üé® VISUALIZACI√ìN EN DASHBOARD

### Iconos para Features Bloqueados

En el men√∫ lateral del dashboard, agregar indicadores visuales:

```html
<!-- Ejemplo de item con feature bloqueado -->
<a href="#" class="sidebar-item locked" onclick="showUpgradeModal('analytics_advanced')">
    <i class="fas fa-chart-line"></i>
    <span>An√°lisis Avanzado</span>
    <i class="fas fa-lock ml-auto text-xs text-amber-400"></i>
    <span class="ml-1 text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full font-semibold">PRO</span>
</a>

<!-- Ejemplo de item con feature disponible -->
<a href="{% url 'reports:dashboard' %}" class="sidebar-item">
    <i class="fas fa-file-alt"></i>
    <span>Reportes</span>
</a>

<!-- Ejemplo de item con l√≠mite pr√≥ximo -->
<a href="{% url 'appointments:list' %}" class="sidebar-item">
    <i class="fas fa-calendar-alt"></i>
    <span>Citas</span>
    <span class="ml-auto text-xs text-orange-600">45/50</span>
</a>
```

### Badges por Plan Requerido

```
üîì Sin badge = Incluido en Plan Free
üíº B√ÅSICO = Requiere Plan B√°sico o superior
üöÄ PRO = Requiere Plan Profesional o superior
üíé PREMIUM = Solo Plan Premium
```

---

## üìä ADD-ONS DISPONIBLES

### Para Plan B√°sico y Profesional

```
1. Facturaci√≥n Electr√≥nica DIAN
   - Precio: +$29.900/mes
   - Incluye: 500 facturas/mes
   - Adicionales: $20 COP c/u

2. N√≥mina Electr√≥nica DIAN
   - Precio: +$39.900/mes
   - Incluye: Hasta 10 empleados
   - Adicionales: $3.900/empleado

3. Mensajes WhatsApp Extra
   - Paquetes:
     * 1.000 mensajes: $35.000
     * 5.000 mensajes: $150.000
     * 10.000 mensajes: $250.000

4. Almacenamiento Extra
   - 10 GB: +$9.900/mes
   - 50 GB: +$39.900/mes
   - 100 GB: +$69.900/mes
```

---

## üéØ ESTRATEGIA DE CONVERSI√ìN

### Del Free al B√°sico
**Triggers:**
1. Llegar a 80 pacientes (80% del l√≠mite)
2. Llegar a 40 citas/mes (80% del l√≠mite)
3. Necesitar m√°s de 2 doctores
4. Querer personalizar landing page
5. Necesitar control de inventario
6. D√≠a 25 de los 30 d√≠as de prueba

### Del B√°sico al Profesional
**Triggers:**
1. Necesitar WhatsApp para recordatorios autom√°ticos
2. Querer facturaci√≥n electr√≥nica
3. Necesitar m√°s de 3 usuarios
4. Querer promociones autom√°ticas
5. Necesitar workflows para eficiencia
6. An√°lisis avanzados y reportes personalizados

### Del Profesional al Premium
**Triggers:**
1. Abrir una segunda o tercera sede
2. Necesitar m√°s de 10 usuarios
3. Necesitar integraci√≥n con sistemas externos (API)
4. Facturar m√°s de 500 documentos/mes
5. Necesitar soporte 24/7
6. An√°lisis predictivo con IA

---

## ‚úÖ PR√ìXIMOS PASOS

1. **Crear PlanFeatures en base de datos**
   - Script para crear los 23 features
   - Asignar categor√≠as e iconos

2. **Actualizar SubscriptionPlans**
   - Asignar features a cada plan
   - Actualizar l√≠mites seg√∫n nueva estrategia

3. **Implementar Decoradores de Permisos**
   ```python
   @require_feature('analytics_advanced')
   def analytics_dashboard(request):
       ...
   
   @require_plan('professional')
   def workflows_create(request):
       ...
   ```

4. **Actualizar Template Tags**
   ```django
   {% if user|has_feature:'whatsapp_integration' %}
       <!-- Mostrar m√≥dulo WhatsApp -->
   {% else %}
       <!-- Mostrar upgrade prompt -->
   {% endif %}
   ```

5. **Crear Modales de Upgrade**
   - Modal explicando beneficios del upgrade
   - Comparaci√≥n visual de planes
   - Call-to-action claro

6. **Dashboard con Indicadores**
   - Badges de plan requerido en sidebar
   - Iconos de candado en features bloqueados
   - Contador de l√≠mites (ej: "45/50 citas")
   - Barra de progreso para l√≠mites

7. **Scripts de Migraci√≥n**
   - Migrar usuarios existentes a nuevos planes
   - Asignar features seg√∫n plan actual
