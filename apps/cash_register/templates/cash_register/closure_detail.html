{% extends 'dashboard/base.html' %}
{% load cash_filters %}

{% block title %}Cierre de Caja - {{ closure.closure_date|date:"d/m/Y" }}{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{% url 'cash_register:closure_list' %}" class="text-blue-600 hover:text-blue-700 mb-4 inline-block">
        <i class="fas fa-arrow-left mr-2"></i>Volver
    </a>
    <h1 class="text-3xl font-bold">Cierre de Caja - {{ closure.cash_register.name }}</h1>
    <p class="text-gray-600">{{ closure.closure_date|date:"d/m/Y" }}</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-xl font-bold mb-4">Resumen del Sistema</h2>
        <div class="space-y-3">
            <div class="flex justify-between">
                <span>Apertura:</span>
                <span class="font-semibold">${{ closure.opening_amount|currency }}</span>
            </div>
            <div class="flex justify-between text-green-600">
                <span>Ingresos:</span>
                <span class="font-semibold">${{ closure.total_income|currency }}</span>
            </div>
            <div class="flex justify-between text-red-600">
                <span>Egresos:</span>
                <span class="font-semibold">${{ closure.total_expenses|currency }}</span>
            </div>
            <div class="border-t pt-3 flex justify-between text-lg">
                <span class="font-bold">Esperado:</span>
                <span class="font-bold">${{ closure.expected_amount|currency }}</span>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-xl font-bold mb-4">Conteo FÃ­sico</h2>
        <div class="space-y-3">
            <div class="flex justify-between">
                <span>Efectivo:</span>
                <span class="font-semibold">${{ closure.counted_cash|currency }}</span>
            </div>
            <div class="flex justify-between">
                <span>Tarjetas:</span>
                <span class="font-semibold">${{ closure.counted_cards|currency }}</span>
            </div>
            <div class="flex justify-between">
                <span>Transferencias:</span>
                <span class="font-semibold">${{ closure.counted_transfers|currency }}</span>
            </div>
            <div class="border-t pt-3 flex justify-between text-lg">
                <span class="font-bold">Total Contado:</span>
                <span class="font-bold">${{ closure.total_counted|currency }}</span>
            </div>
            <div class="border-t pt-3 flex justify-between text-xl">
                <span class="font-bold">Diferencia:</span>
                <span class="font-bold {% if closure.difference > 0 %}text-green-600{% elif closure.difference < 0 %}text-red-600{% endif %}">
                    {% if closure.difference > 0 %}+{% endif %}${{ closure.difference|currency }}
                </span>
            </div>
        </div>
    </div>
</div>

{% if closure.notes %}
<div class="bg-white rounded-xl shadow-lg p-6 mt-6">
    <h2 class="text-xl font-bold mb-4">Observaciones</h2>
    <p class="text-gray-700">{{ closure.notes }}</p>
</div>
{% endif %}

{% if closure.status == 'PENDING' %}
<div class="mt-6 flex space-x-3">
    <form method="post" action="{% url 'cash_register:approve_closure' closure.pk %}" class="flex-1">
        {% csrf_token %}
        <button type="submit" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
            <i class="fas fa-check mr-2"></i>Aprobar Cierre
        </button>
    </form>
    <form method="post" action="{% url 'cash_register:reject_closure' closure.pk %}" class="flex-1">
        {% csrf_token %}
        <button type="submit" class="w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700">
            <i class="fas fa-times mr-2"></i>Rechazar Cierre
        </button>
    </form>
</div>
{% endif %}
{% endblock %}
