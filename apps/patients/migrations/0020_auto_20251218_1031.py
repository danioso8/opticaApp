# Generated by Django 3.2.25 on 2025-12-18 15:31

import django.core.validators
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('organizations', '0012_subscriptionplan_max_organizations'),
        ('patients', '0019_force_sphere_to_varchar'),
    ]

    operations = [
        migrations.CreateModel(
            name='ExamOrder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_type', models.CharField(choices=[('tonometry', 'Tonometría (Presión Intraocular)'), ('visual_field', 'Campo Visual / Campimetría'), ('retinography', 'Retinografía / Fondo de Ojo'), ('oct', 'OCT (Tomografía Coherencia Óptica)'), ('corneal_topography', 'Topografía Corneal'), ('pachymetry', 'Paquimetría'), ('keratometry', 'Queratometría'), ('color_vision', 'Test de Visión de Colores'), ('contrast_sensitivity', 'Test de Sensibilidad al Contraste'), ('motility', 'Estudio de Motilidad Ocular'), ('pupillometry', 'Pupilometría'), ('biometry', 'Biometría Ocular'), ('gonioscopy', 'Gonioscopia'), ('fluorescein_angiography', 'Angiografía Fluoresceínica'), ('other', 'Otro Examen')], max_length=50, verbose_name='Tipo de Examen')),
                ('order_date', models.DateField(verbose_name='Fecha de Orden')),
                ('priority', models.CharField(choices=[('routine', 'Rutina'), ('urgent', 'Urgente'), ('stat', 'STAT (Inmediato)')], default='routine', max_length=20, verbose_name='Prioridad')),
                ('status', models.CharField(choices=[('pending', 'Pendiente'), ('scheduled', 'Agendado'), ('in_progress', 'En Proceso'), ('completed', 'Completado'), ('cancelled', 'Cancelado')], default='pending', max_length=20, verbose_name='Estado')),
                ('clinical_indication', models.TextField(help_text='Motivo por el cual se solicita el examen', verbose_name='Indicación Clínica')),
                ('special_instructions', models.TextField(blank=True, help_text='Indicaciones especiales para el técnico o paciente', verbose_name='Instrucciones Especiales')),
                ('scheduled_date', models.DateField(blank=True, null=True, verbose_name='Fecha Agendada')),
                ('performed_date', models.DateField(blank=True, null=True, verbose_name='Fecha Realizada')),
                ('observations', models.TextField(blank=True, verbose_name='Observaciones')),
                ('cancellation_reason', models.TextField(blank=True, verbose_name='Motivo de Cancelación')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Orden de Examen',
                'verbose_name_plural': 'Órdenes de Exámenes',
                'ordering': ['-order_date', '-created_at'],
            },
        ),
        migrations.AlterField(
            model_name='clinicalhistory',
            name='refraction_od_sphere',
            field=models.CharField(blank=True, help_text='Ej: +2.50, -1.25, N/A', max_length=10, verbose_name='OD Esfera'),
        ),
        migrations.AlterField(
            model_name='clinicalhistory',
            name='refraction_os_sphere',
            field=models.CharField(blank=True, help_text='Ej: +2.50, -1.25, N/A', max_length=10, verbose_name='OS Esfera'),
        ),
        migrations.CreateModel(
            name='VisualFieldTest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('test_type', models.CharField(choices=[('confrontation', 'Confrontación Manual'), ('goldman', 'Perímetro de Goldman'), ('humphrey', 'Humphrey (Computarizado)'), ('octopus', 'Octopus'), ('automated', 'Automatizado Genérico')], max_length=30, verbose_name='Tipo de Test')),
                ('strategy', models.CharField(blank=True, choices=[('24-2', 'SITA Standard 24-2'), ('30-2', 'SITA Standard 30-2'), ('10-2', 'SITA Standard 10-2'), ('fast', 'SITA Fast'), ('full_threshold', 'Full Threshold')], max_length=30, verbose_name='Estrategia')),
                ('od_result', models.CharField(choices=[('normal', 'Normal'), ('borderline', 'Limítrofe'), ('mild_defect', 'Defecto Leve'), ('moderate_defect', 'Defecto Moderado'), ('severe_defect', 'Defecto Severo')], max_length=30, verbose_name='Resultado OD')),
                ('od_mean_deviation', models.DecimalField(blank=True, decimal_places=2, help_text='Mean Deviation', max_digits=5, null=True, verbose_name='MD OD (dB)')),
                ('od_pattern_std_deviation', models.DecimalField(blank=True, decimal_places=2, help_text='Pattern Standard Deviation', max_digits=5, null=True, verbose_name='PSD OD (dB)')),
                ('od_visual_field_index', models.DecimalField(blank=True, decimal_places=2, help_text='Visual Field Index', max_digits=5, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='VFI OD (%)')),
                ('os_result', models.CharField(choices=[('normal', 'Normal'), ('borderline', 'Limítrofe'), ('mild_defect', 'Defecto Leve'), ('moderate_defect', 'Defecto Moderado'), ('severe_defect', 'Defecto Severo')], max_length=30, verbose_name='Resultado OS')),
                ('os_mean_deviation', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='MD OS (dB)')),
                ('os_pattern_std_deviation', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='PSD OS (dB)')),
                ('os_visual_field_index', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='VFI OS (%)')),
                ('reliability_fixation_losses', models.CharField(blank=True, max_length=50, verbose_name='Pérdidas de Fijación')),
                ('reliability_false_positives', models.CharField(blank=True, max_length=50, verbose_name='Falsos Positivos')),
                ('reliability_false_negatives', models.CharField(blank=True, max_length=50, verbose_name='Falsos Negativos')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='visualfieldtest_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Campo Visual',
                'verbose_name_plural': 'Campos Visuales',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.CreateModel(
            name='Tonometry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('method', models.CharField(choices=[('goldman', 'Goldman (Aplanación)'), ('air_puff', 'Aire (No Contacto)'), ('icare', 'iCare (Rebote)'), ('pascal', 'Pascal (Contorno Dinámico)'), ('schiotz', 'Schiötz (Indentación)'), ('tonopen', 'Tonopen')], max_length=20, verbose_name='Método de Medición')),
                ('time_measured', models.TimeField(help_text='Importante: la PIO varía durante el día', verbose_name='Hora de Medición')),
                ('od_pressure', models.DecimalField(decimal_places=1, help_text='Presión intraocular ojo derecho', max_digits=4, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(80)], verbose_name='PIO OD (mmHg)')),
                ('od_notes', models.CharField(blank=True, max_length=200, verbose_name='Notas OD')),
                ('os_pressure', models.DecimalField(decimal_places=1, help_text='Presión intraocular ojo izquierdo', max_digits=4, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(80)], verbose_name='PIO OS (mmHg)')),
                ('os_notes', models.CharField(blank=True, max_length=200, verbose_name='Notas OS')),
                ('pachymetry_corrected', models.BooleanField(default=False, help_text='Si se aplicó corrección por grosor corneal', verbose_name='Corregido por Paquimetría')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tonometry_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Tonometría',
                'verbose_name_plural': 'Tonometrías',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.CreateModel(
            name='Retinography',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('dilated_pupil', models.BooleanField(default=True, help_text='Se realizó con midriasis', verbose_name='Pupila Dilatada')),
                ('dilation_drug', models.CharField(blank=True, help_text='Ej: Tropicamida 1%', max_length=100, verbose_name='Medicamento para Dilatación')),
                ('od_view', models.CharField(choices=[('posterior_pole', 'Polo Posterior'), ('macula', 'Mácula'), ('optic_disc', 'Disco Óptico'), ('peripheral', 'Periférica'), ('widefield', 'Campo Amplio')], max_length=30, verbose_name='Vista OD')),
                ('od_findings', models.CharField(choices=[('normal', 'Normal'), ('drusen', 'Drusas'), ('hemorrhages', 'Hemorragias'), ('exudates', 'Exudados'), ('microaneurysms', 'Microaneurismas'), ('cotton_wool', 'Exudados Algodonosos'), ('neovascularization', 'Neovascularización'), ('disc_edema', 'Edema de Disco'), ('cup_disc_abnormal', 'Relación C/D Anormal'), ('other', 'Otros Hallazgos')], max_length=50, verbose_name='Hallazgos OD')),
                ('od_cup_disc_ratio', models.DecimalField(blank=True, decimal_places=2, help_text='Relación copa/disco óptico', max_digits=3, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)], verbose_name='Relación C/D OD')),
                ('od_description', models.TextField(blank=True, verbose_name='Descripción OD')),
                ('od_image', models.FileField(blank=True, null=True, upload_to='retinography/%Y/%m/', verbose_name='Imagen OD')),
                ('os_view', models.CharField(choices=[('posterior_pole', 'Polo Posterior'), ('macula', 'Mácula'), ('optic_disc', 'Disco Óptico'), ('peripheral', 'Periférica'), ('widefield', 'Campo Amplio')], max_length=30, verbose_name='Vista OS')),
                ('os_findings', models.CharField(choices=[('normal', 'Normal'), ('drusen', 'Drusas'), ('hemorrhages', 'Hemorragias'), ('exudates', 'Exudados'), ('microaneurysms', 'Microaneurismas'), ('cotton_wool', 'Exudados Algodonosos'), ('neovascularization', 'Neovascularización'), ('disc_edema', 'Edema de Disco'), ('cup_disc_abnormal', 'Relación C/D Anormal'), ('other', 'Otros Hallazgos')], max_length=50, verbose_name='Hallazgos OS')),
                ('os_cup_disc_ratio', models.DecimalField(blank=True, decimal_places=2, max_digits=3, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)], verbose_name='Relación C/D OS')),
                ('os_description', models.TextField(blank=True, verbose_name='Descripción OS')),
                ('os_image', models.FileField(blank=True, null=True, upload_to='retinography/%Y/%m/', verbose_name='Imagen OS')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='retinography_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Retinografía',
                'verbose_name_plural': 'Retinografías',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.CreateModel(
            name='Pachymetry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('method', models.CharField(choices=[('ultrasound', 'Ultrasonido'), ('optical', 'Óptica (OCT/Scheimpflug)')], max_length=20, verbose_name='Método de Medición')),
                ('od_central_thickness', models.IntegerField(help_text='Grosor corneal central', verbose_name='Grosor Central OD (μm)')),
                ('os_central_thickness', models.IntegerField(verbose_name='Grosor Central OS (μm)')),
                ('od_superior', models.IntegerField(blank=True, null=True, verbose_name='Superior OD (μm)')),
                ('od_inferior', models.IntegerField(blank=True, null=True, verbose_name='Inferior OD (μm)')),
                ('od_nasal', models.IntegerField(blank=True, null=True, verbose_name='Nasal OD (μm)')),
                ('od_temporal', models.IntegerField(blank=True, null=True, verbose_name='Temporal OD (μm)')),
                ('os_superior', models.IntegerField(blank=True, null=True, verbose_name='Superior OS (μm)')),
                ('os_inferior', models.IntegerField(blank=True, null=True, verbose_name='Inferior OS (μm)')),
                ('os_nasal', models.IntegerField(blank=True, null=True, verbose_name='Nasal OS (μm)')),
                ('os_temporal', models.IntegerField(blank=True, null=True, verbose_name='Temporal OS (μm)')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='pachymetry_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Paquimetría',
                'verbose_name_plural': 'Paquimetrías',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.CreateModel(
            name='OCTExam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('scan_area', models.CharField(choices=[('macula', 'Mácula'), ('optic_nerve', 'Nervio Óptico / RNFL'), ('anterior_segment', 'Segmento Anterior'), ('choroid', 'Coroides')], max_length=30, verbose_name='Área Escaneada')),
                ('scan_pattern', models.CharField(choices=[('macular_cube', 'Cubo Macular'), ('optic_disc_cube', 'Cubo Disco Óptico'), ('rnfl_circle', 'Círculo RNFL'), ('line_scan', 'Línea'), ('radial', 'Radial')], max_length=30, verbose_name='Patrón de Escaneo')),
                ('od_central_thickness', models.IntegerField(blank=True, help_text='Grosor foveal central', null=True, verbose_name='Grosor Central OD (μm)')),
                ('os_central_thickness', models.IntegerField(blank=True, null=True, verbose_name='Grosor Central OS (μm)')),
                ('od_rnfl_average', models.IntegerField(blank=True, null=True, verbose_name='RNFL Promedio OD (μm)')),
                ('od_rnfl_superior', models.IntegerField(blank=True, null=True, verbose_name='RNFL Superior OD (μm)')),
                ('od_rnfl_inferior', models.IntegerField(blank=True, null=True, verbose_name='RNFL Inferior OD (μm)')),
                ('od_rnfl_nasal', models.IntegerField(blank=True, null=True, verbose_name='RNFL Nasal OD (μm)')),
                ('od_rnfl_temporal', models.IntegerField(blank=True, null=True, verbose_name='RNFL Temporal OD (μm)')),
                ('os_rnfl_average', models.IntegerField(blank=True, null=True, verbose_name='RNFL Promedio OS (μm)')),
                ('os_rnfl_superior', models.IntegerField(blank=True, null=True, verbose_name='RNFL Superior OS (μm)')),
                ('os_rnfl_inferior', models.IntegerField(blank=True, null=True, verbose_name='RNFL Inferior OS (μm)')),
                ('os_rnfl_nasal', models.IntegerField(blank=True, null=True, verbose_name='RNFL Nasal OS (μm)')),
                ('os_rnfl_temporal', models.IntegerField(blank=True, null=True, verbose_name='RNFL Temporal OS (μm)')),
                ('od_signal_strength', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(10)], verbose_name='Fuerza de Señal OD')),
                ('os_signal_strength', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(10)], verbose_name='Fuerza de Señal OS')),
                ('od_report', models.FileField(blank=True, null=True, upload_to='oct/%Y/%m/', verbose_name='Reporte OD')),
                ('os_report', models.FileField(blank=True, null=True, upload_to='oct/%Y/%m/', verbose_name='Reporte OS')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='octexam_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'OCT',
                'verbose_name_plural': 'OCTs',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.CreateModel(
            name='MotilityExam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('cover_test_distance', models.CharField(blank=True, choices=[('ortophoria', 'Ortoforía (Normal)'), ('esophoria', 'Esoforía'), ('exophoria', 'Exoforía'), ('hyperphoria', 'Hiperforía'), ('esotropia', 'Esotropía'), ('exotropia', 'Exotropía'), ('hypertropia', 'Hipertropía')], max_length=30, verbose_name='Cover Test Lejos')),
                ('cover_test_near', models.CharField(blank=True, choices=[('ortophoria', 'Ortoforía (Normal)'), ('esophoria', 'Esoforía'), ('exophoria', 'Exoforía'), ('hyperphoria', 'Hiperforía'), ('esotropia', 'Esotropía'), ('exotropia', 'Exotropía'), ('hypertropia', 'Hipertropía')], max_length=30, verbose_name='Cover Test Cerca')),
                ('deviation_horizontal', models.CharField(blank=True, help_text='Ej: 10Δ eso, 15Δ exo', max_length=50, verbose_name='Desviación Horizontal')),
                ('deviation_vertical', models.CharField(blank=True, help_text='Ej: 5Δ RHT, 3Δ LHT', max_length=50, verbose_name='Desviación Vertical')),
                ('versions_normal', models.BooleanField(default=True, verbose_name='Versiones Normales')),
                ('versions_notes', models.TextField(blank=True, help_text='Restricciones en alguna posición', verbose_name='Notas Versiones')),
                ('ductions_od_normal', models.BooleanField(default=True, verbose_name='Ducciones OD Normales')),
                ('ductions_os_normal', models.BooleanField(default=True, verbose_name='Ducciones OS Normales')),
                ('ductions_notes', models.TextField(blank=True, verbose_name='Notas Ducciones')),
                ('near_point_convergence', models.CharField(blank=True, help_text='Ej: 8 cm, 10 cm', max_length=50, verbose_name='Punto Próximo de Convergencia')),
                ('convergence_recovery', models.CharField(blank=True, max_length=50, verbose_name='Recuperación de Convergencia')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='motilityexam_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Examen de Motilidad',
                'verbose_name_plural': 'Exámenes de Motilidad',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.CreateModel(
            name='Keratometry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('method', models.CharField(choices=[('manual', 'Manual'), ('automated', 'Automatizada'), ('topography', 'Por Topografía')], max_length=20, verbose_name='Método')),
                ('od_k1', models.DecimalField(decimal_places=2, help_text='Meridiano más plano', max_digits=5, verbose_name='K1 OD (D)')),
                ('od_k1_axis', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K1 OD (°)')),
                ('od_k2', models.DecimalField(decimal_places=2, help_text='Meridiano más curvo', max_digits=5, verbose_name='K2 OD (D)')),
                ('od_k2_axis', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K2 OD (°)')),
                ('os_k1', models.DecimalField(decimal_places=2, max_digits=5, verbose_name='K1 OS (D)')),
                ('os_k1_axis', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K1 OS (°)')),
                ('os_k2', models.DecimalField(decimal_places=2, max_digits=5, verbose_name='K2 OS (D)')),
                ('os_k2_axis', models.IntegerField(validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K2 OS (°)')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='keratometry_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Queratometría',
                'verbose_name_plural': 'Queratometrías',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.AddField(
            model_name='examorder',
            name='clinical_history',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exam_orders', to='patients.clinicalhistory', verbose_name='Historia Clínica'),
        ),
        migrations.AddField(
            model_name='examorder',
            name='ordered_by',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exam_orders', to='patients.doctor', verbose_name='Ordenado por'),
        ),
        migrations.AddField(
            model_name='examorder',
            name='organization',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='examorder_set', to='organizations.organization', verbose_name='Organización'),
        ),
        migrations.AddField(
            model_name='examorder',
            name='performed_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='performed_exams', to='patients.doctor', verbose_name='Realizado por'),
        ),
        migrations.CreateModel(
            name='CornealTopography',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('topography_type', models.CharField(choices=[('placido', 'Placido (Disco)'), ('scheimpflug', 'Scheimpflug'), ('elevation', 'Elevación'), ('combined', 'Combinada')], max_length=30, verbose_name='Tipo de Topografía')),
                ('purpose', models.CharField(choices=[('contact_lens', 'Adaptación Lentes de Contacto'), ('refractive_surgery', 'Evaluación Cirugía Refractiva'), ('keratoconus', 'Sospecha Queratocono'), ('post_surgical', 'Post-quirúrgico'), ('routine', 'Control Rutinario')], max_length=30, verbose_name='Propósito del Estudio')),
                ('od_k1', models.DecimalField(blank=True, decimal_places=2, help_text='Curvatura más plana', max_digits=5, null=True, verbose_name='K1 OD (D)')),
                ('od_k1_axis', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K1 OD (°)')),
                ('od_k2', models.DecimalField(blank=True, decimal_places=2, help_text='Curvatura más curva', max_digits=5, null=True, verbose_name='K2 OD (D)')),
                ('od_k2_axis', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K2 OD (°)')),
                ('od_avg_k', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='K Promedio OD (D)')),
                ('od_corneal_astigmatism', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Astigmatismo Corneal OD (D)')),
                ('os_k1', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='K1 OS (D)')),
                ('os_k1_axis', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K1 OS (°)')),
                ('os_k2', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='K2 OS (D)')),
                ('os_k2_axis', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(180)], verbose_name='Eje K2 OS (°)')),
                ('os_avg_k', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='K Promedio OS (D)')),
                ('os_corneal_astigmatism', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Astigmatismo Corneal OS (D)')),
                ('od_keratoconus_suspect', models.BooleanField(default=False, verbose_name='Sospecha Queratocono OD')),
                ('os_keratoconus_suspect', models.BooleanField(default=False, verbose_name='Sospecha Queratocono OS')),
                ('od_map', models.FileField(blank=True, null=True, upload_to='topography/%Y/%m/', verbose_name='Mapa OD')),
                ('os_map', models.FileField(blank=True, null=True, upload_to='topography/%Y/%m/', verbose_name='Mapa OS')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='cornealtopography_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Topografía Corneal',
                'verbose_name_plural': 'Topografías Corneales',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.CreateModel(
            name='ColorVisionTest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('exam_date', models.DateField(verbose_name='Fecha del Examen')),
                ('equipment_used', models.CharField(blank=True, help_text='Marca y modelo del equipo', max_length=200, verbose_name='Equipo Utilizado')),
                ('findings', models.TextField(blank=True, help_text='Descripción de hallazgos del examen', verbose_name='Hallazgos')),
                ('interpretation', models.TextField(blank=True, help_text='Interpretación clínica de los resultados', verbose_name='Interpretación')),
                ('recommendations', models.TextField(blank=True, help_text='Recomendaciones basadas en los resultados', verbose_name='Recomendaciones')),
                ('requires_follow_up', models.BooleanField(default=False, verbose_name='Requiere Seguimiento')),
                ('follow_up_period', models.CharField(blank=True, help_text='Ej: 3 meses, 6 meses, 1 año', max_length=100, verbose_name='Período de Seguimiento')),
                ('attachment', models.FileField(blank=True, help_text='Imagen o reporte del examen', null=True, upload_to='clinical_exams/%Y/%m/', verbose_name='Archivo Adjunto')),
                ('notes', models.TextField(blank=True, verbose_name='Notas Adicionales')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('test_type', models.CharField(choices=[('ishihara', 'Ishihara (Placas)'), ('farnsworth_d15', 'Farnsworth D-15'), ('farnsworth_munsell', 'Farnsworth-Munsell 100'), ('hrd', 'HRR (Hardy-Rand-Ritter)')], max_length=30, verbose_name='Tipo de Test')),
                ('od_result', models.CharField(choices=[('normal', 'Normal (Tricromático)'), ('protanomaly', 'Protanomalía (Débil rojo)'), ('protanopia', 'Protanopia (Ciego rojo)'), ('deuteranomaly', 'Deuteranomalía (Débil verde)'), ('deuteranopia', 'Deuteranopia (Ciego verde)'), ('tritanomaly', 'Tritanomalía (Débil azul)'), ('tritanopia', 'Tritanopia (Ciego azul)'), ('achromatopsia', 'Acromatopsia')], max_length=30, verbose_name='Resultado OD')),
                ('od_score', models.CharField(blank=True, help_text='Ej: 15/17 placas correctas', max_length=50, verbose_name='Puntuación OD')),
                ('os_result', models.CharField(choices=[('normal', 'Normal (Tricromático)'), ('protanomaly', 'Protanomalía (Débil rojo)'), ('protanopia', 'Protanopia (Ciego rojo)'), ('deuteranomaly', 'Deuteranomalía (Débil verde)'), ('deuteranopia', 'Deuteranopia (Ciego verde)'), ('tritanomaly', 'Tritanomalía (Débil azul)'), ('tritanopia', 'Tritanopia (Ciego azul)'), ('achromatopsia', 'Acromatopsia')], max_length=30, verbose_name='Resultado OS')),
                ('os_score', models.CharField(blank=True, max_length=50, verbose_name='Puntuación OS')),
                ('clinical_history', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='patients.clinicalhistory', verbose_name='Historia Clínica')),
                ('exam_order', models.OneToOneField(blank=True, help_text='Orden médica que generó este examen', null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.examorder', verbose_name='Orden Asociada')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='colorvisiontest_set', to='organizations.organization', verbose_name='Organización')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='patients.doctor', verbose_name='Realizado por')),
            ],
            options={
                'verbose_name': 'Test de Visión de Colores',
                'verbose_name_plural': 'Tests de Visión de Colores',
                'ordering': ['-exam_date'],
            },
        ),
        migrations.AddIndex(
            model_name='examorder',
            index=models.Index(fields=['organization', 'clinical_history', '-order_date'], name='patients_ex_organiz_da8819_idx'),
        ),
        migrations.AddIndex(
            model_name='examorder',
            index=models.Index(fields=['organization', 'status', '-order_date'], name='patients_ex_organiz_ee7c4e_idx'),
        ),
    ]
