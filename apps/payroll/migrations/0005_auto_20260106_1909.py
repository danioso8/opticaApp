# Generated by Django 3.2.25 on 2026-01-07 00:09

from decimal import Decimal
from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('organizations', '0025_alter_organization_owner'),
        ('payroll', '0004_auto_20260106_1837'),
    ]

    operations = [
        migrations.CreateModel(
            name='VacationRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('fecha_inicio', models.DateField()),
                ('fecha_fin', models.DateField()),
                ('fecha_reintegro', models.DateField(help_text='Fecha de regreso al trabajo')),
                ('dias_solicitados', models.IntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('dias_habiles', models.IntegerField(help_text='Días hábiles (sin contar fines de semana)', validators=[django.core.validators.MinValueValidator(1)])),
                ('dias_calendario', models.IntegerField(help_text='Días de calendario totales', validators=[django.core.validators.MinValueValidator(1)])),
                ('periodo_inicio', models.DateField(help_text='Inicio del período laboral que causan estas vacaciones')),
                ('periodo_fin', models.DateField(help_text='Fin del período laboral que causan estas vacaciones')),
                ('estado', models.CharField(choices=[('PENDIENTE', 'Pendiente de Aprobación'), ('APROBADA', 'Aprobada'), ('RECHAZADA', 'Rechazada'), ('DISFRUTADA', 'Disfrutada'), ('CANCELADA', 'Cancelada')], default='PENDIENTE', max_length=20)),
                ('fecha_solicitud', models.DateTimeField(auto_now_add=True)),
                ('fecha_aprobacion', models.DateTimeField(blank=True, null=True)),
                ('pago_anticipado', models.BooleanField(default=True, help_text='¿Se paga antes de salir a vacaciones?')),
                ('valor_pago', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('fecha_pago', models.DateField(blank=True, null=True)),
                ('motivo_rechazo', models.TextField(blank=True)),
                ('observaciones', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('aprobado_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vacaciones_aprobadas', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='solicitudes_vacaciones', to='payroll.employee')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='vacationrequest_set', to='organizations.organization', verbose_name='Organización')),
            ],
            options={
                'verbose_name': 'Solicitud de Vacaciones',
                'verbose_name_plural': 'Solicitudes de Vacaciones',
                'ordering': ['-fecha_solicitud'],
            },
        ),
        migrations.CreateModel(
            name='SocialBenefit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('tipo', models.CharField(choices=[('CESANTIAS', 'Cesantías'), ('INTERESES_CESANTIAS', 'Intereses sobre Cesantías'), ('PRIMA', 'Prima de Servicios'), ('VACACIONES', 'Vacaciones')], max_length=30)),
                ('fecha_inicio', models.DateField()),
                ('fecha_fin', models.DateField()),
                ('dias_causados', models.IntegerField(default=0)),
                ('valor_causado', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('valor_pagado', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('saldo_pendiente', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('calculado_automaticamente', models.BooleanField(default=False)),
                ('fecha_calculo', models.DateTimeField(blank=True, null=True)),
                ('observaciones', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='prestaciones_sociales', to='payroll.employee')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='socialbenefit_set', to='organizations.organization', verbose_name='Organización')),
            ],
            options={
                'verbose_name': 'Prestación Social',
                'verbose_name_plural': 'Prestaciones Sociales',
                'ordering': ['-fecha_fin', 'employee', 'tipo'],
            },
        ),
        migrations.CreateModel(
            name='PILAReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('numero_planilla', models.CharField(max_length=50, unique=True)),
                ('fecha_generacion', models.DateTimeField(auto_now_add=True)),
                ('fecha_envio', models.DateTimeField(blank=True, null=True)),
                ('mes', models.IntegerField(validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(12)])),
                ('anio', models.IntegerField(validators=[django.core.validators.MinValueValidator(2020), django.core.validators.MaxValueValidator(2100)])),
                ('total_empleados', models.IntegerField(default=0)),
                ('total_salud', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_pension', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_riesgos', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_caja', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_aportes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('estado', models.CharField(choices=[('BORRADOR', 'Borrador'), ('GENERADO', 'Generado'), ('ENVIADO', 'Enviado'), ('VALIDADO', 'Validado'), ('RECHAZADO', 'Rechazado')], default='BORRADOR', max_length=20)),
                ('archivo_pila', models.FileField(blank=True, help_text='Archivo en formato PILA', null=True, upload_to='pila/%Y/%m/')),
                ('respuesta_operador', models.TextField(blank=True)),
                ('errores', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='pilareport_set', to='organizations.organization', verbose_name='Organización')),
                ('period', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='reportes_pila', to='payroll.payrollperiod')),
            ],
            options={
                'verbose_name': 'Reporte PILA',
                'verbose_name_plural': 'Reportes PILA',
                'ordering': ['-anio', '-mes'],
            },
        ),
        migrations.CreateModel(
            name='MonthlyProvision',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('cesantias', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Provisión mensual de cesantías (8.33%)', max_digits=12)),
                ('intereses_cesantias', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Provisión mensual de intereses sobre cesantías (1%)', max_digits=12)),
                ('prima', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Provisión mensual de prima (8.33%)', max_digits=12)),
                ('vacaciones', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Provisión mensual de vacaciones (4.17%)', max_digits=12)),
                ('total_provision', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('salario_base', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('calculado_automaticamente', models.BooleanField(default=False)),
                ('fecha_calculo', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='provisiones_mensuales', to='payroll.employee')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='monthlyprovision_set', to='organizations.organization', verbose_name='Organización')),
                ('period', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='provisiones', to='payroll.payrollperiod')),
            ],
            options={
                'verbose_name': 'Provisión Mensual',
                'verbose_name_plural': 'Provisiones Mensuales',
                'ordering': ['-period', 'employee'],
            },
        ),
        migrations.CreateModel(
            name='LaborContract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('numero_contrato', models.CharField(max_length=50, unique=True)),
                ('tipo_contrato', models.CharField(choices=[('INDEFINIDO', 'Término Indefinido'), ('FIJO', 'Término Fijo'), ('OBRA_LABOR', 'Obra o Labor'), ('PRESTACION_SERVICIOS', 'Prestación de Servicios'), ('APRENDIZAJE', 'Aprendizaje'), ('TEMPORAL', 'Temporal')], max_length=30)),
                ('estado', models.CharField(choices=[('ACTIVO', 'Activo'), ('SUSPENDIDO', 'Suspendido'), ('TERMINADO', 'Terminado'), ('LIQUIDADO', 'Liquidado')], default='ACTIVO', max_length=20)),
                ('fecha_inicio', models.DateField()),
                ('fecha_fin', models.DateField(blank=True, help_text='Solo para contratos a término fijo', null=True)),
                ('fecha_terminacion', models.DateField(blank=True, null=True)),
                ('salario_contratado', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))])),
                ('auxilio_transporte', models.BooleanField(default=True, help_text='¿Tiene derecho a auxilio de transporte?')),
                ('horas_semanales', models.IntegerField(default=48, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(168)])),
                ('causal_terminacion', models.TextField(blank=True)),
                ('preaviso_dado', models.BooleanField(default=False)),
                ('archivo_contrato', models.FileField(blank=True, null=True, upload_to='contratos/%Y/%m/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='contratos', to='payroll.employee')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='laborcontract_set', to='organizations.organization', verbose_name='Organización')),
            ],
            options={
                'verbose_name': 'Contrato Laboral',
                'verbose_name_plural': 'Contratos Laborales',
                'ordering': ['-fecha_inicio'],
            },
        ),
        migrations.CreateModel(
            name='EmployeeLoan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('numero_prestamo', models.CharField(max_length=50, unique=True)),
                ('fecha_solicitud', models.DateField()),
                ('fecha_aprobacion', models.DateField(blank=True, null=True)),
                ('fecha_desembolso', models.DateField(blank=True, null=True)),
                ('monto_solicitado', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('1.00'))])),
                ('monto_aprobado', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('numero_cuotas', models.IntegerField(help_text='Número de cuotas para pagar', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(60)])),
                ('valor_cuota', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('cuotas_pagadas', models.IntegerField(default=0)),
                ('tasa_interes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Tasa de interés mensual (%)', max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00')), django.core.validators.MaxValueValidator(Decimal('100.00'))])),
                ('total_pagado', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('saldo_pendiente', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('estado', models.CharField(choices=[('SOLICITADO', 'Solicitado'), ('APROBADO', 'Aprobado'), ('RECHAZADO', 'Rechazado'), ('ACTIVO', 'Activo - En descuento'), ('PAGADO', 'Pagado'), ('CANCELADO', 'Cancelado')], default='SOLICITADO', max_length=20)),
                ('motivo_solicitud', models.TextField()),
                ('motivo_rechazo', models.TextField(blank=True)),
                ('observaciones', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('aprobado_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='prestamos_aprobados', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='prestamos', to='payroll.employee')),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='employeeloan_set', to='organizations.organization', verbose_name='Organización')),
            ],
            options={
                'verbose_name': 'Préstamo a Empleado',
                'verbose_name_plural': 'Préstamos a Empleados',
                'ordering': ['-fecha_solicitud'],
            },
        ),
        migrations.AddIndex(
            model_name='vacationrequest',
            index=models.Index(fields=['organization', 'employee', 'estado'], name='payroll_vac_organiz_e7fcf8_idx'),
        ),
        migrations.AddIndex(
            model_name='vacationrequest',
            index=models.Index(fields=['fecha_inicio', 'fecha_fin'], name='payroll_vac_fecha_i_28a8ab_idx'),
        ),
        migrations.AddIndex(
            model_name='socialbenefit',
            index=models.Index(fields=['organization', 'employee', 'tipo'], name='payroll_soc_organiz_d5c0f0_idx'),
        ),
        migrations.AddIndex(
            model_name='socialbenefit',
            index=models.Index(fields=['fecha_inicio', 'fecha_fin'], name='payroll_soc_fecha_i_bf4c33_idx'),
        ),
        migrations.AddIndex(
            model_name='pilareport',
            index=models.Index(fields=['organization', 'mes', 'anio'], name='payroll_pil_organiz_4d065e_idx'),
        ),
        migrations.AddIndex(
            model_name='pilareport',
            index=models.Index(fields=['numero_planilla'], name='payroll_pil_numero__49bdcc_idx'),
        ),
        migrations.AddIndex(
            model_name='monthlyprovision',
            index=models.Index(fields=['organization', 'period'], name='payroll_mon_organiz_a40908_idx'),
        ),
        migrations.AddIndex(
            model_name='monthlyprovision',
            index=models.Index(fields=['employee'], name='payroll_mon_employe_7c645f_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='monthlyprovision',
            unique_together={('organization', 'period', 'employee')},
        ),
        migrations.AddIndex(
            model_name='laborcontract',
            index=models.Index(fields=['organization', 'employee', 'estado'], name='payroll_lab_organiz_260490_idx'),
        ),
        migrations.AddIndex(
            model_name='laborcontract',
            index=models.Index(fields=['fecha_inicio', 'fecha_fin'], name='payroll_lab_fecha_i_34ee8a_idx'),
        ),
        migrations.AddIndex(
            model_name='employeeloan',
            index=models.Index(fields=['organization', 'employee', 'estado'], name='payroll_emp_organiz_6487d1_idx'),
        ),
        migrations.AddIndex(
            model_name='employeeloan',
            index=models.Index(fields=['numero_prestamo'], name='payroll_emp_numero__1c34b6_idx'),
        ),
    ]
